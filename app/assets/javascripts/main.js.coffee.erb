Simmr = angular.module('Simmr', ['ngResource', 'rails', 'ui', 'ui.bootstrap'])

Simmr.controller "EventRegisterCtrl", ["$scope",  "$routeParams", "$location", ($scope, $routeParams, $location) ->
  $scope.guest = {}
  $scope.guest.name = ''
  $scope.guest.email = ''
  $scope.buyer = {}
  $scope.buyer.name = ''
  $scope.buyer.ccNumber = ''
  $scope.buyer.ccSecCode = ''
  $scope.buyer.ccExpMonth = ''
  $scope.buyer.ccExpYear = ''
  $scope.buyer.billingAddress = ''
  $scope.buyer.billingCity = ''
  $scope.buyer.billingState = ''
  $scope.buyer.billingZip = ''
  
  $scope.total = ->
    $scope.num_guests * parseInt($scope.cost)

  $scope.gotoPayment = ->
  	if ($scope.guest.name == '')
  		$scope.guest.nameError = true
  	else
  		$scope.guest.nameError = false

  	if ($scope.guest.email == '')
  		$scope.guest.emailError = true
  	else
  		$scope.guest.emailError = false

  	if ($scope.guest.emailError == false) and ($scope.guest.nameError == false)
  		$scope.payment = 2

  $scope.submitPayment = ->
    if $scope.buyer.name == ''
    	$scope.buyer.nameError = true
    else
    	$scope.buyer.nameError = false

    if $scope.buyer.ccNumber == ''
    	$scope.buyer.ccNumberError = true
    else
    	$scope.buyer.ccNumberError = false

    if $scope.buyer.ccSecCode == ''
    	$scope.buyer.ccSecCodeError = true
    else
    	$scope.buyer.ccSecCodeError = false

    if $scope.buyer.ccExpMonth == ''
    	$scope.buyer.ccExpMonthError = true
    else
    	$scope.buyer.ccExpMonthError = false

    if $scope.buyer.ccExpYear == ''
    	$scope.buyer.ccExpYearError = true
    else
    	$scope.buyer.ccExpYearError = false

    if $scope.buyer.billingAddress == ''
    	$scope.buyer.billingAddressError = true
    else
    	$scope.buyer.billingAddressError = false

    if $scope.buyer.billingCity == ''
    	$scope.buyer.billingCityError = true
    else
    	$scope.buyer.billingCityError = false

    if $scope.buyer.billingState == ''
    	$scope.buyer.billingStateError = true
    else
    	$scope.buyer.billingStateError = false

    if $scope.buyer.billingZip == ''
    	$scope.buyer.billingZipError = true
    else
    	$scope.buyer.billingZipError = false

    if $scope.buyer.nameError == false and $scope.buyer.ccNumberError == false and $scope.buyer.ccSecCodeError == false and $scope.buyer.ccExpMonthError == false and $scope.buyer.ccExpYearError == false and $scope.buyer.billingAddressError == false and $scope.buyer.billingCityError == false and $scope.buyer.billingStateError == false and $scope.buyer.billingZipError == false
    	$scope.payment = 3
    	$(document).on "click", "#ticket_purchase", ->
    	  $("#new_charge").submit()
]